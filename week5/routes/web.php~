<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Api\StudentApiController;
use App\Http\Controllers\AuthController;
use App\Http\Controllers\RoleOrPermissionController;
use App\Http\Controllers\ForgotPasswordController;
Route::middleware('auth')->group(function () {
    Route::get('/students', [App\Http\Controllers\StudentController::class, 'index'])->name('index');
    Route::resource('/students',\App\Http\Controllers\StudentController::class)->middleware('auth');
    Route::resource('/classes',\App\Http\Controllers\ClassroomController::class);
    Route::resource('/departments',\App\Http\Controllers\DepartmentController::class);
});
Route::get('/', function () {
    return auth()->check() ? redirect()->route('index') : redirect()->route('login');
});

Route::get('/login', [AuthController::class, 'ShowFormLogin'])->name('login');
Route::post('/login', [AuthController::class, 'login'])->name('login.process');
Route::post('/logout', [AuthController::class, 'logout'])->name('logout');
Route::get('/forget-password', [\App\Http\Controllers\ForgotPasswordController::class, 'showForgotPasswordForm'])->name('forget-password');
Route::post('/forget-password', [\App\Http\Controllers\ForgotPasswordController::class, 'sendLinkEmail'])->name('forget-password.send');
Route::get('reset-password/{token}', [ForgotPasswordController::class, 'showResetForm'])->name('password.reset');
Route::post('reset-password', [ForgotPasswordController::class, 'reset'])->name('password.update');


Route::get('/register', [AuthController::class, 'showRegisterForm'])->name('register');
Route::post('/register', [AuthController::class, 'register'])->name('register.process');
Route::delete('/users/{user}', [AuthController::class, 'destroy'])->name('users.destroy');
Route::middleware(['auth','role:admin'])->group(function () {
    Route::get('/list-account',[\App\Http\Controllers\RoleOrPermissionController::class,'index'])->name('list-account');
    Route::post('/list-account/{user}/change-role', [RoleOrPermissionController::class, 'changeRole'])->name('users.changeRole');
    Route::get('/update-permission-for-role',[RoleOrPermissionController::class,'listPermission'])->name('list.permission');
    Route::post('/list-permission/update',[RoleOrPermissionController::class,'updatePermission'])->name('update.permission');

    Route::get('/roles',[RoleOrPermissionController::class,'listRole'])->name('roles.index');
    Route::get('/roles/create',[RoleOrPermissionController::class,'createRole'])->name('roles.create');
    Route::post('/roles',[RoleOrPermissionController::class,'storeRole'])->name('roles.store');
    Route::delete('/roles/{id}', [RoleOrPermissionController::class, 'destroyRole'])->name('roles.destroy');
});




